---
title: "photosynthesis_model_comparison"
author: "Joanna"
date: "2025-01-23"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Run the models

```{r}
weather_original <- read_and_combine_weather_data(2015, 2018, base_path = "~/Documents/CASSIA/data/weather_original_")
weather_original$date <- as.Date(strptime(paste(rep(2015:2018, times = c(365, 366, 365, 365)), weather_original$X), format = "%Y %j"))

CASSIA_spp <- CASSIA_cpp(weather_original, "Hyde", tests = TRUE)

weather_preles <- data.table::fread("~/Documents/CASSIA/data/ERA5_CASSIA_preles.csv")

CASSIA_preles <- CASSIA_cpp(weather = weather_preles,
                            site = "Hyde",
                            pPREL = c(parameters_all$pPREL, parameters_all$N_parameters),
                            parameters = parameters_all$parameters_test,
                            common = common_p,
                            ratios = ratios_p,
                            sperling = parameters_all$sperling_test,
                            needle_mass_in = parameters_all$needle_mass_in,
                            Throughfall = parameters_all$Throughfall,
                            photosynthesis_as_input = FALSE,
                            preles = TRUE)

```

```{r}
par(mfrow = c(2, 2))
plot(CASSIA_preles$Growth$root_growth, ylab = "Root Growth", xlab = "Time")
plot(CASSIA_preles$Growth$respiration_growth + CASSIA_preles$Growth$respiration_maintenance, ylab = "Respiration", xlab = "Time")
plot(CASSIA_preles$Growth$diameter_growth, ylab = "Diameter Growth", xlab = "Time")
plot(CASSIA_preles$Preles$GPP, ylab = "GPP", xlab = "Time")
```

## Preles against SPP (short term)

```{r cars}

plot_comparison(CASSIA_spp, variables_new,
                Hyde_daily_original_plot, variables_original, soil_processes)

plot_sugar_starch_comparison(CASSIA_new_output, processed_data$dates, loaded_data$original_data, loaded_data$yu_data)

plot(CASSIA_spp$Preles$GPP, col = "blue")
points(CASSIA_preles$Preles$GPP, col = "black")
# 2019 check the 

# TODO: make this work!
CASSIA_preles_plot <- CASSIA_preles
CASSIA_preles_plot$Growth <- CASSIA_preles$Growth[CASSIA_preles$Growth$year %in% 2015:2017,]

plot_comparison(CASSIA_preles_plot, variables_new,
                Hyde_daily_original_plot, variables_original, FALSE)
```

## Preles and Phydro long term

```{r pressure, echo=FALSE}
new_parameters <- rep(0.5, 27)  # Example new parameters
  calibration = F
  parameters_all <- initialize_parameters(calibration, new_parameters)

  data.direct = "./data/"
  phydro <- data.table::fread(paste0(data.direct, "phydro_smear_CASSIA_ready.csv"))
  preles <- data.table::fread(paste0(data.direct, "preles_smear_CASSIA_ready.csv"))

  smear_preles <- CASSIA_cpp(weather = preles,
                             site = "Hyde",
                             pPREL = c(parameters_all$pPREL, parameters_all$N_parameters),
                             parameters = parameters_all$parameters_test,
                             common = common_p,
                             ratios = ratios_p,
                             sperling = parameters_all$sperling_test,
                             needle_mass_in = parameters_all$needle_mass_in,
                             Throughfall = parameters_all$Throughfall,
                             photosynthesis_as_input = FALSE)

  # TODO: add into the parameters all formulation
  phydro_parameters_in = c(0.1008, 0.180496537959982, 5, 0.026263945805926, 0.011, 50,
                           0.5, -0.857817410110663, 4.1311874912949e17, 1, 2.45e-2, 2.0, 1.1, 0.1,
                           15, 10, 5, 0, 1, exp(-0.5 * 1.8), exp(-0.5 * 3.5), exp(-0.5 * 5.5))

  smear_phydro <- CASSIA_cpp(weather = phydro,
                             site = "Hyde",
                             pPREL = c(parameters_all$pPREL, parameters_all$N_parameters),
                             parameters = parameters_all$parameters_test,
                             common = common_p,
                             ratios = ratios_p,
                             sperling = parameters_all$sperling_test,
                             needle_mass_in = parameters_all$needle_mass_in,
                             phydro = phydro_parameters_in,
                             Throughfall = parameters_all$Throughfall,
                             photosynthesis_as_input = FALSE,
                             ecoevolutionary = TRUE)

  par(mfrow = c(3, 1))
  plot(smear_preles$Preles$GPP, xlab = "Days since 2018-01-01", ylab = "Photosynthesis", col = "blue")
  points(smear_phydro$Preles$GPP, col = "green")

  plot(smear_preles$Growth$diameter_growth, xlab = "Days since 2018-01-01", ylab = "Diameter, kg C", col = "blue")
  points(smear_phydro$Growth$diameter_growth, col = "green")

  plot(smear_preles$Growth$root_growth, xlab = "Days since 2018-01-01", ylab = "Root, kg C", col = "blue")
  points(smear_phydro$Growth$root_growth, col = "green")

```

